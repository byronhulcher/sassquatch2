<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Sassquatch 2: Full view example</title>

	<!-- Whitney -->
	<link rel="stylesheet" href="http://static1.meetupstatic.com/fonts/whitney.css" type="text/css" />

	<!-- Styleguide CSS -->
	<link rel="stylesheet" href="../css/doc.css">
	<link rel="stylesheet" href="../css/github.css">

	<!-- CSS to be documented -->
	<link rel="stylesheet" href="../css/sassquatch.css">
</head>

<body>
	<div class="view">
		<header class="view-head">
			<h1>View Head</h1>
		</header>
		<main class="view-body">

			<header class="stripe--photoHero" style="background-image: url(http://www.catsinmyyard.com/wp-content/uploads/2012/12/DSC03499.jpg);">
				<div class="bounds stripe-heroContent inverted">
					<h1 class="text--display">Hero header</h1>
				</div>
			</header>

			<section class="stripe">
				<div class="bounds">
					<h2>I have a list of things</h2>
					<p>You should try resizing the browser and scrolling.</p>

					<ul class="list">
						<li class="row">
							<div class="row-item--shrink group">
								<a href="#" class="avatar avatar--person" style="background-image: url(http://hostedmedia.reimanpub.com/TOH/Images/Photos/37/300x300/exps29222_W101973175C05_17_2bC.jpg);"></a>
							</div>
							<div class="row-item group">
								<h3>Eggs</h3>
								<p>Have some eggs.</p>
							</div>
						</li>
						<li class="row">
							<div class="row-item--shrink group">
								<a href="#" class="avatar avatar--person" style="background-image: url(http://hostedmedia.reimanpub.com/TOH/Images/Photos/37/300x300/exps29222_W101973175C05_17_2bC.jpg);"></a>
							</div>
							<div class="row-item group">
								<h3>More eggs</h3>
								<p>Have some eggs.</p>
							</div>
						</li>
						<li class="row">
							<div class="row-item--shrink group">
								<a href="#" class="avatar avatar--person" style="background-image: url(http://hostedmedia.reimanpub.com/TOH/Images/Photos/37/300x300/exps29222_W101973175C05_17_2bC.jpg);"></a>
							</div>
							<div class="row-item group">
								<h3>Even more eggs</h3>
								<p>Have some eggs.</p>
							</div>
						</li>
					</ul>
				</div>
			</section>

			<section class="stripe--inverted inverted">
				<div class="bounds">

					<div class="group">
						<h2>I'm in a group</h2>
						<p>just a content group here, nothing too special.</p>
					</div>

					<div class="group">
						<h2>I'm in a group</h2>
						<p>just a content group here, nothing too special.</p>
					</div>

				</div>
			</section>

		</main>
	</div>

	    <script type="text/javascript">
    // Add this chunk of code to your hologram footer
    // to enable the ability to see the rules that
    // define a class when you click on it.
    (function(document) {

      //elements that hold classnames
      var sClass = document.getElementsByClassName('s');
      var codeTags = document.getElementsByTagName('code');

      //attach events to the potential classnames
      Array.prototype.forEach.call(sClass, function(el){
        el.onclick = cssNameInspect;
      });

      Array.prototype.forEach.call(codeTags, function(el){
        el.onclick = cssNameInspect;
      });

      /**
       * Given an element that might have css classnames in it
       * get the css for those classnames.
       */
      function cssNameInspect(event){
        var el = event.currentTarget;
        var cssRegex = /[^a-zA-Z0-9\s]{1,}/;
        var valid = false;
        var matchingRulesArray =[];
        var mainCssRules = document.styleSheets[0].rules;

        //if it's CODE, make sure it looks like css class(es)
        //if it's an .s, make sure it's prevSibling .na says 'class='
        if(el.nodeName == 'CODE' && !cssRegex.test(el.innerText)) {
          valid = true;
        } else if (el.nodeName == 'SPAN' && prevNode(el).innerText == "class=") {
          valid = true;
        }

        if(valid) {
          el.innerText.split(/\s+/).forEach(function(selectorRaw) {
            var selector = selectorRaw.replace(/\"/g, '');
            matchingRulesArray = matchingRulesArray.concat(getMatchesFromRules(selector, mainCssRules));
          });

          if (matchingRulesArray) {
            cssContentFormatted = rulesArrayToHtml(matchingRulesArray);
            infoPane(cssContentFormatted, [event.pageX, event.pageY]);
          }
        }
      }

      /**
       * Given an array of css rules and a selector
       * get the css rules that apply to just that selector
       * and return them in an array.
       */
      function getMatchesFromRules(selector, rules) {
        var cssContent = [];
        Array.prototype.forEach.call(rules, function(rule){
          //for 'foo' match .foo | .bar, .foo, .baz | .bar, .foo | element.foo | .foo:hover | .foo::before
          regexString = '(^|, |[a-z]{1,})\\.' + selector + '(\\:{1,2}[^\\s]{1,}|,|\\.|[\\s]{1,}\\{)';

          var regexp = new RegExp(regexString);
          // console.log('regex: ' + regexp);
          if (regexp.test(rule.cssText)) {
            cssContent.push(rule.cssText);
          }
        });
        return cssContent;
      }

      function rulesArrayToHtml(content) {
        return content
                .join('<hr>')
                .replace(/(;)/g,'$1<br>\n')
                .replace(/({)/g,'$1<div style="padding-left: 5px">\n')
                .replace(/(})/g,'</div>$1\n');
      }

      /**
       * Create the hovering element with content
       * right where the user clicked. coords is [X,Y]
       */
      function infoPane(content, coords) {
        var popUp = document.createElement("div");
        var close  = document.createElement("div");
        var css  = document.createElement("div");

        popUp.style.position = 'absolute';
        popUp.style.left = coords[0] + 'px';
        popUp.style.top = coords[1] + 'px';
        popUp.style.maxWidth = '500px';
        popUp.style.maxHeight = '500px';
        popUp.style.overflow = 'scroll';
        popUp.style.color = '#eee';
        popUp.style.backgroundColor = '#202020';
        popUp.style.border =  '2px solid #000';
        popUp.style.padding =  '5px';
        popUp.style.borderRadius = '5px';

        close.style.backgroundColor = '#000';
        close.style.color = '#ddd';
        close.style.fontSize = '80%';
        close.style.fontStyle = 'italic';
        close.style.textAlign = 'center';
        close.style.cursor = 'pointer';
        close.innerHTML = "click here to close";

        css.innerHTML = content;

        popUp.appendChild(close);
        popUp.appendChild(css);

        //add the ability to close the div.
        close.onclick = function(event) {
          document.body.removeChild(popUp);
        };

        document.body.appendChild(popUp);
      }

      /**
       * Helper function to get the non text node
       * previousSibling of an element
       */
      function prevNode(el) {
        var prevSibling = el.previousSibling;
        if (prevSibling.nodeType != Node.TEXT_NODE) {
          return prevSibling;
        } else {
          prevNode(prevSibling);
        }
      }
    })(document);
    </script>
</body>
</html>
